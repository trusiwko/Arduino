# Трехцветный светодиод

Трехцветный светодиод содержит в себе синий, зеленый и красный. Если смешать в разных насыщенностях каждый из них, можно получить практически любой цвет. 

Если смешать красный и синий, получим пурпурный цвет (фуксия), если смешать синий и зеленый, получим сине-зеленый или бирюзовый цвет. А если смешать красный и зеленый, то получим желтый.

![rgb](https://github.com/trusiwko/Arduino/raw/master/eKids/Lesson7/rgb.jpg)

У светодиода 4 ноги - три для каждого цвета и одна общая на землю (самая длинная). Мы будем их подключать к ШИМ пинам ардуино, чтобы плавно увеличивать и уменьшать яркость каждого из цветов, таким образом мы сможем сделать переливы.

План такой: 
0) Предварительно зажигаем красный.
1) Плавно зажигаем синий. При зажженном красном и синем получим пурпурный.
2) Плавно гасим красный. Остается только синий.
3) Плавно зажигаем зеленый. При зажженном синем и зеленом получим бирюзовый.
4) Плавно гасим синий. Остается только зеленый.
5) Плавно зажигаем красный. При зажженном красном и зеленом получим желтый.
6) Плавно гасим зеленый. Остается только красный.
Возвращаемся к п.1 нашего цикла.

Для каждого шага нам необходимо плавно уменьшать или увеличивать яркость светодиода. Для этого воспользуемся циклом от 0 до 255 или от 255 до 0 и в нем с помощью `analogWrite` будем изменять яркость. Но тогда код получится большим и сложночитаемым. Самый верный вариант - это создать процедуру, которая будет плавно зажигать светодиод или плавно его гасить, а в программе просто вызывать данную процедуру.
Назовем процедуру smooth (плавный по английски), она будет выглядеть так:

```C++
// Процедура для плавного перелива. Указываем с какого значения до какого
//  увеличивать (или уменьшать) значение на 1.
void smooth(int pin, int from, int to) {
  // Будем изменять переменную from до тех пор, пока она не станет равной переменной to
  // Сделаем копию переменной from, назовем ее c и будем работать с ней
  int c = from;
  // У нас два варианта, бежим по нарастающей от 0 до 255
  if (from < to) {
    while (c < to) {
      analogWrite(pin, c);
      c += 1;
      delay(10);
    }
  // Или бежим по убывающей от 255 до 0
  } else {
    while (c > to) {
      analogWrite(pin, c);
      c -= 1;
      delay(10);
    }
  }
  // Ждем секунду для закрепления цвета
  delay(1000);
}
```

Процедура на вход ожидает 3 числа:
1. Пин, у которого изменять значение.
2. Значение, которое установлено сейчас (или 0, или 255).
3. Значение, которое должно быть (или 255, или 0).

В процедуре мы смотрим в какую сторону бежим - по нарастающей или по убывающей и соответственно меняем значение. Ждем 10 мс для закрепления результата.

Теперь мы можем вызывать данную процедуру в коде программы:

```C++
void loop()
{
  analogWrite(RED, 255); // Красный (включим для первого запуска)
  smooth(BLUE, 0, 255);  // Фуксия (пурпурный) (R+B)
  smooth(RED, 255, 0);   // Синий (B)
  smooth(GREEN, 0, 255); // Сине-зеленый (G+B)
  smooth(BLUE, 255, 0);  // Зеленый (G)
  smooth(RED, 0, 255);   // Желтый (R+G)
  smooth(GREEN, 255, 0); // Красный (R)
}
```

Можно добавить еще переменную для управления скоростью смены цветов, чтобы вместо +1 или -1 цвет изменялся быстрее. Добавим переменную `speed`. Итоговый код:

```C++
#define RED 9
#define GREEN 11
#define BLUE 10

int speed = 5; // Скорость, с которой будет нарастать яркость

void setup()
{
  pinMode(RED, OUTPUT);
  pinMode(GREEN, OUTPUT);
  pinMode(BLUE, OUTPUT);
}

// Процедура для плавного перелива. Указываем с какого значения до какого
//  увеличивать (или уменьшать) значение на 1.
void smooth(int pin, int from, int to) {
  // Будем изменять переменную from до тех пор, пока она не станет равной переменной to
  // Сделаем копию переменной from, назовем ее c и будем работать с ней
  int c = from;
  // У нас два варианта, бежим по нарастающей от 0 до 255
  if (from < to) {
    while (c < to) {
      analogWrite(pin, c);
      c += speed;
      delay(10);
    }
  // Или бежим по убывающей от 255 до 0
  } else {
    while (c > to) {
      analogWrite(pin, c);
      c -= speed;
      delay(10);
    }
  }
  // Ждем секунду для закрепления цвета
  delay(1000 / speed);
}

void loop()
{
  analogWrite(RED, 255); // Красный (включим для первого запуска)
  smooth(BLUE, 0, 255);  // Фуксия (пурпурный) (R+B)
  smooth(RED, 255, 0);   // Синий (B)
  smooth(GREEN, 0, 255); // Сине-зеленый (G+B)
  smooth(BLUE, 255, 0);  // Зеленый (G)
  smooth(RED, 0, 255);   // Желтый (R+G)
  smooth(GREEN, 255, 0); // Красный (R)
}
```

![demo](https://github.com/trusiwko/Arduino/raw/master/eKids/Lesson7/demo1.gif)

## Случайный цвет

Теперь цвет будем получать случайно. Будем по очереди получать случайное число от 0 до 255 для каждого из цветов: красного, зеленого и синего и будем бежать до полученного значения. Для хранения текущих значений для каждого из трех цветов добавим три переменные: `r` для красного, `g` для зеленого и `b` для синего. А также переменную `v` для временного хранения случайного числа.
Для получения случайного числа существует функция `random(x)`, которая вернет число от 0 до x-1. Мы будем вызывать функцию с параметром 256, чтобы получить случайные числа в диапазоне от 0 до 255.
Чтобы числа получались случайными при каждом запуске, будем слушать шумы с порта 0 (к которому ничего не подключено). Для подключения функции генерации случайных чисел будем использовать конструкцию `randomSeed(analogRead(0))` в блоке _setup_.

Получим следующий код:
```C++
#define RED 9
#define GREEN 11
#define BLUE 10

int speed = 5; // Скорость, с которой будет нарастать яркость
int r = 0;
int g = 0;
int b = 0;
int v;

void setup()
{
  pinMode(RED, OUTPUT);
  pinMode(GREEN, OUTPUT);
  pinMode(BLUE, OUTPUT);
  // Подключим генератор случайных чисел как уловитель шумов с пина 0
  randomSeed(analogRead(0));
}

// Процедура для плавного перелива. Указываем с какого значения до какого
//  увеличивать (или уменьшать) значение на 1.
void smooth(int pin, int from, int to) {
  // Будем изменять переменную from до тех пор, пока она не станет равной переменной to
  // Сделаем копию переменной from, назовем ее c и будем работать с ней
  int c = from;
  // У нас два варианта, бежим по нарастающей от 0 до 255
  if (from < to) {
    while (c < to) {
      analogWrite(pin, c);
      c += speed;
      delay(10);
    }
  // Или бежим по убывающей от 255 до 0
  } else {
    while (c > to) {
      analogWrite(pin, c);
      c -= speed;
      delay(10);
    }
  }
  // Ждем секунду для закрепления цвета
  delay(1000 / speed);
}

void loop()
{
  // Получаем случайный цвет для красного
  v = random(256);
  smooth(RED, r, v); 
  r = v; 
  // Получаем случайный цвет для зеленого
  v = random(256);
  smooth(GREEN, g, v);
  g = v;
  // Получаем случайный цвет для синего
  v = random(256);
  smooth(BLUE, b, v);
  b = v;
}
```
![demo](https://github.com/trusiwko/Arduino/raw/master/eKids/Lesson7/demo2.gif)
